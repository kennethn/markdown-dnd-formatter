$if(layout.onecolumn)$
\documentclass[11pt,onecolumn]{article}
$else$
\documentclass[11pt,twocolumn]{article}
$endif$

% =========================
% 1. Packages
% =========================

% Font and encoding
\usepackage{microtype}
\usepackage{soul}            % for underlines
\usepackage[normalem]{ulem}  % prevents soul/ulem conflicts
\usepackage{fontawesome5}
\usepackage[T1]{fontenc}
\usepackage{Alegreya}
\usepackage{fontspec}
\usepackage[document]{ragged2e}
\usepackage[none]{hyphenat}
\usepackage{parskip}
\usepackage{needspace}
\usepackage{amssymb}

% Hyperlinks (no colors)
\usepackage[hidelinks]{hyperref}
\usepackage{xcolor}

% Page layout
\usepackage[paper=letterpaper,top=0.35in,bottom=0.50in,left=0.35in,right=0.35in]{geometry}
\usepackage{titlesec}
\usepackage{etoolbox}
\usepackage[all]{nowidow}

% Page numbering and headers/footers
\usepackage{fancyhdr}

% Lists
\usepackage{enumitem}

% Math
\usepackage{amsfonts}

% Tables
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}
\usepackage{multirow}
\usepackage{colortbl}
\usepackage{tabularx}

% Colored boxes
\usepackage[most]{tcolorbox}

% Graphics
\usepackage{graphicx}

% =========================
% 2. Global Settings
% =========================

\RaggedRight
\setlength{\parskip}{8pt} % flexible ~20pt spacing
\setlength{\parindent}{0pt} % no indent for first lines
\setlength{\columnsep}{24pt}

\pagestyle{plain}
\raggedbottom

% =========================
% 3. Fonts and Font Commands
% =========================

\newfontfamily\AlegreyaSC{Alegreya SC}
\renewcommand{\textsc}[1]{{\AlegreyaSC#1}}

\newfontfamily\blockquoteFont{Ysabeau}[
  Ligatures=TeX,
  Numbers=Lining, 
  Mapping=tex-text               
]
\newfontfamily\headerfont{Ysabeau SC SemiBold}[
  Ligatures=TeX,
  Numbers=Lining,
  Scale=1.05
]

\newfontfamily\emojifont{Noto Color Emoji}

% =========================
% 4. Section Formatting
% =========================

\newcommand{\stickysection}{\needspace{5\baselineskip}}
\newcommand{\stickysubsection}{\needspace{4\baselineskip}}
\newcommand{\stickysubsubsection}{\needspace{3\baselineskip}}

\newcommand{\sectionsize}{\LARGE}
\newcommand{\subsectionsize}{\Large}
\newcommand{\subsubsectionsize}{\large}

\renewcommand{\ULdepth}{0.5ex}  % adjust this value to move the underline
\renewcommand{\ULthickness}{0.03em}  % underline thickness

\linespread{1.2}

% =========================
% 5. Colors
% =========================

\definecolor{sectioncolor}{HTML}{B85042}      
\definecolor{subsectioncolor}{HTML}{B85042}    
\definecolor{subsubsectioncolor}{HTML}{B85042} 
\definecolor{subsubsubsectioncolor}{HTML}{B85042} 

\definecolor{keywordcolor}{HTML}{B85042}
\definecolor{highlightcolor}{HTML}{E7E8D1}
\definecolor{encountercolor}{HTML}{dfaca5}
\definecolor{imagecolor}{HTML}{A7BEAE}

% =========================
% 6. Text and List Styling
% =========================

\let\oldtextbf\textbf
\renewcommand{\textbf}[1]{\oldtextbf{\textcolor{keywordcolor}{#1}}}

% Stylize bullets in itemize lists
\setlist[itemize,1]{label=\textcolor{keywordcolor}{\textbullet}}
\setlist[itemize,2]{label=\textbullet}
\setlist[itemize,3]{label=\textcolor{keywordcolor}{\textendash}}

% Always override item spacing for itemize outside monsterblocks
\setlist[itemize]{itemsep=4pt, topsep=0pt, parsep=0pt, partopsep=0pt}

% Ensure Pandoc-generated \tightlist honors this too
\providecommand{\tightlist}{
  \setlength{\itemsep}{4pt}
  \setlength{\topsep}{0pt}
  \setlength{\parsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\partopsep}{0pt}
}

% =========================
% 7. Section Titles and Spacing
% =========================

\titleformat{\section}[block]{\stickysection\sectionsize\color{sectioncolor}\headerfont}{}
  {0pt}{}
\titleformat{\subsection}[block]
  {\stickysubsection\subsectionsize\color{subsectioncolor}\headerfont}
  {}
  {0pt}
  {}
  [\vspace{1pt}\color{subsectioncolor}\hrule height 1pt]

\titleformat{\subsubsection}[block]
  {\subsubsectionsize\color{subsubsectioncolor}\headerfont}
  {}
  {0pt}
  {\stickysubsubsection\subsubsectionsize\color{subsubsectioncolor}\headerfont}
  [\vspace{1pt}\color{subsubsectioncolor}\hrule height 1pt]
\titlespacing*{\section}{0pt}{14pt plus 2pt minus 1pt}{10pt}
\titlespacing*{\subsection}{0pt}{12pt plus 1pt minus 1pt}{10pt}
\titlespacing*{\subsubsection}{0pt}{10pt plus 1pt minus 1pt}{12pt}
\titlespacing*{\subsubsubsection}{0pt}{10pt plus 1pt minus 1pt}{12pt}

% =========================
% 8. Headers, Footers, and Pagination
% =========================

\fancyhf{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\pagestyle{fancy}
\setlength{\footskip}{15pt}

% \clubpenalty=10000  % Avoid orphans (first line of a paragraph at bottom of page)
% \widowpenalty=10000 % Avoid widows (last line of paragraph at top of page)
% \displaywidowpenalty=10000

\clubpenalty=9996
\widowpenalty=9999
\brokenpenalty=4991
\predisplaypenalty=10000
\postdisplaypenalty=1549
\displaywidowpenalty=1602

% =========================
% 9. Environments and Boxes
% =========================

% Graphics
\setkeys{Gin}{width=0.48\textwidth, keepaspectratio}
\providecommand{\maxwidth}{\linewidth}
\providecommand{\maxheight}{0.9\textheight}
\providecommand{\pandocbounded}[1]{#1}

\renewenvironment{quote}
  {%
    \begingroup
      % restore normal indent & spacing
      \setlength{\parindent}{1em}%
      \setlength{\parskip}{0pt}%
      \begin{tcolorbox}[myquote,
        before upper={%
          \let\textbf\oldtextbf
          % <-- set indent & skip *inside* the box
          \setlength{\parindent}{1.5em}%
          \setlength{\parskip}{0pt}%
          \noindent              % <-- suppress *first* paragraph indent
        }%
      ]%
  }
  {%
      \end{tcolorbox}%
    \endgroup
  }

% Blockquote style (D&D-style box with Sans Serif)
\tcbset{myquote/.style={
  breakable,
  enhanced,
  colback={highlightcolor},
  boxrule=0pt,
  arc=0pt,
  left=6pt,
  right=6pt,
  top=4pt,
  bottom=4pt,
  boxsep=4pt,
  before skip=12pt,
  after skip=12pt,
  borderline west={1.5pt}{0pt}{keywordcolor},
  borderline east={1.5pt}{0pt}{keywordcolor},
  sharp corners,
  fontupper=\blockquoteFont\small,
  before upper={%
    \setlength{\parskip}{4pt}%
    \setlength{\baselineskip}{10pt}%
  }
}}

% =========================
% 10. Miscellaneous Tweaks
% =========================

\makeatletter
% Remove vertical space before \section at top of page
\patchcmd{\@startsection}
  {\@afterindenttrue}
  {\@afterindentfalse}
  {}{}
\patchcmd{\@startsection}
  {\@afterheading}
  {\vspace*{-\topskip}\@afterheading}
  {}{}

% Suppress \parskip within list environments
\patchcmd{\@itemize}{\parskip\z@}{\parskip=0pt}{}{}
\patchcmd{\@enumerate}{\parskip\z@}{\parskip=0pt}{}{}
\patchcmd{\@description}{\parskip\z@}{\parskip=0pt}{}{}
\makeatother

% =========================
% 11. Document Content
% =========================

\begin{document}

\begingroup
\makeatletter
\setlength{\@fptop}{0pt}
\vspace*{-\topskip}
\makeatother
\endgroup
\vspace*{-\topskip}

$body$

\end{document}