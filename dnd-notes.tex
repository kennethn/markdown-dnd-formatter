\documentclass[10pt,twocolumn,twoside]{article}

% =========================
% 1. Packages
% =========================

% Font and encoding
\usepackage{microtype}
\usepackage{soul}            % for underlines
\usepackage[normalem]{ulem}  % prevents soul/ulem conflicts
\usepackage{fontawesome5}
\usepackage{fontspec}
\usepackage[document]{ragged2e}
\usepackage[none]{hyphenat}
\usepackage{parskip}
\usepackage{needspace}
\usepackage{amssymb}
\usepackage{contour}
\usepackage{xfp}

% Hyperlinks (no colors)
\usepackage[hidelinks]{hyperref}
\usepackage{xcolor}

% Page layout
\usepackage[paper=letterpaper,top=0.35in,bottom=0.75in,left=0.35in,right=0.35in]{geometry}
\usepackage{titlesec}
\usepackage{etoolbox}

% Page numbering and headers/footers
\usepackage{fancyhdr}

% Lists
\usepackage{enumitem}

% Tables
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}
\usepackage{multirow}
\usepackage{colortbl}
\renewcommand{\arraystretch}{1.15}

% Colored boxes
\usepackage[most]{tcolorbox}

% Graphics
\usepackage{graphicx}

% =========================
% 2. Global Settings
% =========================

\RaggedRight
\setlength{\parskip}{8pt} % flexible ~20pt spacing
\setlength{\parindent}{0pt} % no indent for first lines
\setlength{\columnsep}{24pt}

\pagestyle{fancy}
\raggedbottom

% =========================
% 3. Fonts and Font Commands
% =========================

% Set base font size for body text
\newcommand{\basefontsize}{10}

\setmainfont{Atkinson Hyperlegible Next}[
  Ligatures=Common
]                 
\newfontfamily\blockquoteFont{Atkinson Hyperlegible Next}[
  Ligatures=Common,
  BoldFont={Atkinson Hyperlegible Next SemiBold},
  BoldItalicFont={Atkinson Hyperlegible Next SemiBold Italic},
  Scale=0.9
]   
\newfontfamily\headerfontbold{Atkinson Hyperlegible Next Bold}[
  Ligatures=Common
]       
\newfontfamily\headerfont{Atkinson Hyperlegible Next SemiBold}[
  Ligatures=Common
]
\newfontfamily\monsterFont{Atkinson Hyperlegible Next}[
  Ligatures=Common,
  Scale=0.85,
  BoldFont={Atkinson Hyperlegible Next SemiBold},
  BoldItalicFont={Atkinson Hyperlegible Next SemiBold Italic} 
]

\newfontfamily\emojifont[Renderer=HarfBuzz]{NotoColorEmoji.ttf}

% =========================
% 4. Section Formatting
% =========================

\newcommand{\stickysection}{\needspace{3\baselineskip}}
\newcommand{\stickysubsection}{\needspace{3\baselineskip}}
\newcommand{\stickysubsubsection}{\needspace{3\baselineskip}}

\newcommand{\sectionsize}{\fontsize{\fpeval{\basefontsize * 1.36}pt}{\fpeval{\basefontsize * 1.54}pt}\selectfont}
\newcommand{\subsectionsize}{\fontsize{\fpeval{\basefontsize * 1.18}pt}{\fpeval{\basefontsize * 1.36}pt}\selectfont}
\newcommand{\subsubsectionsize}{\fontsize{\fpeval{\basefontsize * 1.09}pt}{\fpeval{\basefontsize * 1.27}pt}\selectfont}
\newcommand{\paragraphsize}{\fontsize{\fpeval{\basefontsize * 1.045}pt}{\fpeval{\basefontsize * 1.18}pt}\selectfont}
\newcommand{\subparagraphsize}{\fontsize{\fpeval{\basefontsize * 1.0}pt}{\fpeval{\basefontsize * 1.18}pt}\selectfont}

\renewcommand{\ULdepth}{0.5ex}  % adjust this value to move the underline
\renewcommand{\ULthickness}{0.03em}  % underline thickness

\linespread{1.0} % default line spacing

% =========================
% 5. Colors
% =========================

% original dark blue: 003d5b
\definecolor{sectioncolor}{HTML}{30638E}      
\definecolor{keywordcolor}{HTML}{30638E}
\definecolor{highlightcolor}{HTML}{D6F1FF}
\definecolor{highlightborder}{HTML}{30638E}
\definecolor{tableheadercolor}{HTML}{30638E}
\definecolor{encountercolor}{HTML}{A32939}
\definecolor{encounterborder}{HTML}{ffffff}
\definecolor{monstercolor}{HTML}{A32939}
\definecolor{imagecolor}{HTML}{30638e}
\definecolor{imageborder}{HTML}{ffffff}
\definecolor{remembercolor}{HTML}{edae49}
\definecolor{rememberborder}{HTML}{000000}

% Highlighted text
\newcommand{\hlfancy}[2]{\colorlet{hlcolor}{#1}\sethlcolor{hlcolor}\hl{#2}}

% =========================
% 6. Text and List Styling
% =========================

% Allow paragraphs in lists to span columns/pages
\makeatletter
\AtBeginEnvironment{itemize}{%
  \clubpenalty=0 \widowpenalty=0 \displaywidowpenalty=0
  \interlinepenalty=0 \@beginparpenalty=0 \@endparpenalty=0 \@itempenalty=0
}
\AtBeginEnvironment{enumerate}{%
  \clubpenalty=0 \widowpenalty=0 \displaywidowpenalty=0
  \interlinepenalty=0 \@beginparpenalty=0 \@endparpenalty=0 \@itempenalty=0
}
\makeatother

% Always override item spacing for itemize outside monsterblocks
\setlist[itemize]{itemsep=4pt, topsep=1pt, parsep=0pt, partopsep=0pt}

% Ensure Pandoc-generated \tightlist honors this too
\providecommand{\tightlist}{
  \setlength{\itemsep}{4pt}
  \setlength{\topsep}{1pt}
  \setlength{\parsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\partopsep}{0pt}
}
\setlength{\aboverulesep}{0pt}
\setlength{\belowrulesep}{0pt}

% Ensure lists have enough space
\BeforeBeginEnvironment{itemize}{\needspace{1\baselineskip}}
\BeforeBeginEnvironment{enumerate}{\needspace{1\baselineskip}}

% =========================
% 7. Section Titles and Spacing
% =========================

\titleformat{\section}[block]{\stickysection\sectionsize\color{sectioncolor}\headerfontbold}{}
  {0pt}{}

\titleformat{\subsection}[block]
  {\stickysubsection\subsectionsize\color{sectioncolor}\headerfontbold}
  {}
  {0pt}
  {}
  [\hrule height 1pt]

\titleformat{\subsubsection}[block]
  {\stickysubsubsection\subsubsectionsize\color{sectioncolor}\headerfont}
  {}
  {0pt}
  {}
  [\hrule height 0.5pt]

\titleformat{\paragraph}[block]
  {\stickysubsubsection\paragraphsize\color{sectioncolor}\headerfont}
  {}
  {0pt}
  {}

\titlespacing*{\section}      {0pt}{1.5\baselineskip}{0.5\baselineskip}
\titlespacing*{\subsection}   {0pt}{1.25\baselineskip}{0.4\baselineskip}
\titlespacing*{\subsubsection}{0pt}{1.0\baselineskip}{0.3\baselineskip}
\titlespacing*{\paragraph}    {0pt}{0.75\baselineskip}{0.3\baselineskip}
\titlespacing*{\subparagraph} {0pt}{0.5\baselineskip}{0.25\baselineskip}

% =========================
% 8. Headers, Footers, and Pagination
% =========================

\fancyhf{}
\fancyfoot[LE,RO]{\color{sectioncolor}\textbf\thepage}
\fancyfoot[LO,RE]{\color{sectioncolor}\staticleftmark}
\renewcommand{\headrulewidth}{0pt}

% Define a custom colored rule
\makeatletter
\renewcommand{\footrule}{
  \color{sectioncolor} \hrule \@height 1pt \@width \headwidth \vskip2pt
}
\makeatother
\pagestyle{fancy}
\setlength{\footskip}{28pt}

\clubpenalty=10000
\widowpenalty=10000
\brokenpenalty=4991
\predisplaypenalty=10000
\postdisplaypenalty=1549
\displaywidowpenalty=1602

\AtBeginEnvironment{quote}{
  \clubpenalty=10000  % No orphan lines at bottom of page
  \widowpenalty=10000 % No widow lines at top of page
}

\AtBeginEnvironment{quotation}{
  \clubpenalty=10000
  \widowpenalty=10000
}

% =========================
% 9. Environments and Boxes
% =========================

% Graphics
\setkeys{Gin}{width=0.48\textwidth, keepaspectratio}
\providecommand{\maxwidth}{\linewidth}
\providecommand{\maxheight}{0.9\textheight}
\providecommand{\pandocbounded}[1]{#1}

\renewenvironment{quote}
  {%
    \begingroup
      % restore normal indent & spacing
      \setlength{\parindent}{1em}%
      \linespread{1.0}
      \begin{tcolorbox}[myquote,
        before upper={%
          \let\textbf\oldtextbf
          % <-- set indent & skip *inside* the box
          \setlength{\parindent}{1.5em}%
          \setlength{\parskip}{0pt}%
          \noindent              % <-- suppress *first* paragraph indent
        }%
      ]%
  }
  {%
      \end{tcolorbox}%
    \endgroup
  }

% Blockquote style (D&D-style box with Sans Serif)
\tcbset{myquote/.style={
  breakable,
  enhanced,
  colback={highlightcolor},
  boxrule=0pt,
  arc=0pt,
  left=6pt,
  right=6pt,
  top=6pt,
  bottom=4pt,
  boxsep=4pt,
  before skip=12pt,
  after skip=12pt,
  borderline west={2pt}{0pt}{highlightborder},
  borderline east={2pt}{0pt}{highlightborder},
  sharp corners,
  fontupper=\blockquoteFont,
  before upper={%
    \setlength{\parskip}{4pt}%
    \setlength{\baselineskip}{10pt}%
  }
}}

% =========================
% 10. Document Content
% =========================

\begin{document}
\vspace*{-\topskip}
$body$

\end{document}
