$if(layout.onecolumn)$
\documentclass[11pt,onecolumn]{article}
$elseif(layout.landscape)$
\documentclass[11pt,landscape]{article}
$else$
\documentclass[11pt,twocolumn]{article}
$endif$


% Font and encoding
\usepackage{fontspec}
\usepackage{microtype}
\usepackage{soul}            % for underlines
\usepackage[normalem]{ulem} % prevents soul/ulem conflicts

\renewcommand{\ULdepth}{0.5ex}  % adjust this value to move the underline
\renewcommand{\ULthickness}{0.03em}  % underline thickness

\linespread{1.2}
\newcommand{\smallcapstext}[1]{%
  {\addfontfeatures{Letters=SmallCaps,LetterSpace=2.0}\textcolor{keywordcolor}{\textbf{#1}}}%
}

\usepackage{fontawesome5}

\setmainfont{XCharter}[
  SmallCapsFeatures={Letters=SmallCaps}
]


\newfontfamily\blockquoteFont{Ysabeau Office}[
  Ligatures=TeX,
  Numbers=Lining,
  Letters=SmallCaps
]
\newfontfamily\headerfont{Ysabeau Office Bold}[
  Ligatures=TeX,
  Numbers=Lining,
  Scale=1.05
]

% Define emoji font for Unicode emoji ranges
\newfontfamily\emojifont{Noto Color Emoji}

\renewcommand{\blockquoteFont}{\sffamily}


\pagestyle{plain}
\raggedbottom

% No full justification

\usepackage[document]{ragged2e}
\RaggedRight

% Turn off hyphenation
\usepackage[none]{hyphenat}

% Needed to prevent orphaned headings
\usepackage{needspace}
\newcommand{\stickysection}{\needspace{5\baselineskip}}
\newcommand{\stickysubsection}{\needspace{4\baselineskip}}
\newcommand{\stickysubsubsection}{\needspace{3\baselineskip}}

% Page layout
\usepackage[paper=letterpaper,top=0.35in,bottom=0.50in,left=0.35in,right=0.35in]{geometry}
\setlength{\columnsep}{24pt}

% Hyperlinks (no colors)
\usepackage[hidelinks]{hyperref}

% Colors for headings
\usepackage{xcolor}
\definecolor{sectioncolor}{HTML}{8B0000}       % Dark Red
\definecolor{subsectioncolor}{HTML}{8B0000}    % Dark Red
\definecolor{subsubsectioncolor}{HTML}{8B0000} % Dark Red

\definecolor{keywordcolor}{HTML}{8B0000}
\let\oldtextbf\textbf
\renewcommand{\textbf}[1]{\oldtextbf{\textcolor{keywordcolor}{#1}}}

\renewenvironment{quote}
  {\par
   \begin{tcolorbox}[myquote,
     before upper={
       \let\textbf\oldtextbf
     }
   ]}
  {\end{tcolorbox}\par}

\usepackage{etoolbox}
\makeatletter
% Remove vertical space before \section at top of page
\patchcmd{\@startsection}
  {\@afterindenttrue}
  {\@afterindentfalse}
  {}{}
\patchcmd{\@startsection}
  {\@afterheading}
  {\vspace*{-\topskip}\@afterheading}
  {}{}
\makeatother



\usepackage{parskip}
\setlength{\parskip}{8pt} % flexible ~20pt spacing
\setlength{\parindent}{0pt} % no indent for first lines

% Section formatting (no numbering, with colors and spacing)
\usepackage{titlesec}
\titleformat{\section}[block]{\stickysection\Large\color{sectioncolor}\headerfont}{}
  {0pt}{}
\titleformat{\subsection}[block]
  {\stickysubsection\large\color{subsectioncolor}\headerfont}
  {}
  {0pt}
  {}
  [\vspace{1pt}\color{subsectioncolor}\hrule height 1pt]

\titleformat{\subsubsection}[block]
  {\normalsize\color{subsubsectioncolor}\headerfont}
  {}
  {0pt}
  {\stickysubsubsection\normalsize\color{subsubsectioncolor}\headerfont}
  [\vspace{1pt}\color{subsubsectioncolor}\hrule height 1pt]
\titlespacing*{\section}{0pt}{14pt plus 2pt minus 1pt}{10pt}
\titlespacing*{\subsection}{0pt}{12pt plus 1pt minus 1pt}{10pt}
\titlespacing*{\subsubsection}{0pt}{10pt plus 1pt minus 1pt}{12pt}

%\pretocmd{\itemize}{\vspace{6pt}}{}{}
%\apptocmd{\enditemize}{\vspace{6pt}}{}{}

% Page numbering bottom-right
\usepackage{fancyhdr}
\fancyhf{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\pagestyle{fancy}
\setlength{\footskip}{15pt}
\usepackage{enumitem}
\setlist[itemize]{itemsep=10pt, topsep=10pt, parsep=0pt, partopsep=0pt}


% Support for tables
\usepackage{longtable}       % For multi-page tables
\usepackage{booktabs}        % For better-looking tables (\toprule, \midrule, \bottomrule)
\usepackage{array}           % For custom column formatting
\usepackage{multirow}        % Optional: for rowspan-style cells
\usepackage{colortbl}        % Optional: for cell shading
\usepackage{tabularx}        % Optional: for auto-width tables
\usepackage{xcolor}          %

% Support for checkboxes
\usepackage{amssymb} % for \square


% Blockquote style (D&D-style box with Sans Serif)
\usepackage[most]{tcolorbox}
\definecolor{quoteboxbg}{gray}{0.95}
\tcbset{myquote/.style={
  breakable,
  enhanced,
  colback=black!8!white, 
  boxrule=0pt,
  arc=0pt,
  left=6pt,
  right=6pt,
  top=4pt,
  bottom=4pt,
  boxsep=4pt,
  before skip=12pt,
  after skip=12pt,
  borderline west={1.5pt}{0pt}{red!70!black},
  borderline east={1.5pt}{0pt}{red!70!black},
  sharp corners,
  fontupper=\blockquoteFont\small,
  before upper={%
    \setlength{\parskip}{6pt}%
    \setlength{\baselineskip}{14pt}%
  }
}}

% Fix tightlist error
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}
  \setlength{\topsep}{0pt}
  \setlength{\parsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\partopsep}{0pt}
}

\clubpenalty=10000  % Avoid orphans (first line of a paragraph at bottom of page)
\widowpenalty=10000 % Avoid widows (last line of paragraph at top of page)
\displaywidowpenalty=10000

% Highlighting fenced Divs for Encounter and Show Image boxes
\newenvironment{highlightencounterbox}
  {\begin{tcolorbox}[
    enhanced,
    breakable,
    colback=red!10,
    colframe=red!70!black,
    boxrule=0pt,
    arc=2pt,
    left=6pt,
    right=6pt,
    top=2pt,
    bottom=2pt,
    boxsep=4pt,
    before skip=6pt,
    after skip=6pt,
    fontupper=\blockquoteFont\footnotesize,
    before upper={
      \blockquoteFont
      \scriptsize
      \selectfont
      \setlength{\parskip}{5pt}
      \setlength{\baselineskip}{8pt}
    },
    after upper={\par\vspace{10pt}}
  ]{\symbolsfont \textcolor{red!70!black}{⚔}~\textbf{Encounter:}} \par}
  {\end{tcolorbox}}

\newenvironment{highlightshowimagebox}
  {\begin{tcolorbox}[
    enhanced,
    breakable,
    colback=yellow!10,
    colframe=orange!90!black,
    boxrule=0pt;
    frame style={draw=orange!90!black, line width=1pt},
    arc=2pt,
    left=6pt,
    right=6pt,
    top=2pt,
    bottom=2pt,
    boxsep=4pt,
    before skip=6pt,
    after skip=6pt,
    fontupper=\blockquoteFont\footnotesize,
    before upper={%
      \setlength{\parskip}{5pt}
      \setlength{\baselineskip}{8pt}
    }
    after upper={\par\vspace{10pt}}
  ]{\symbolsfont \textcolor{orange!90!black}{◆}~\textbf{Show image:}} \par}
  {\end{tcolorbox}}

% suppress opening top margin
\usepackage{etoolbox}

\makeatletter
% Suppress \parskip within list environments
\patchcmd{\@itemize}{\parskip\z@}{\parskip=0pt}{}{}
\patchcmd{\@enumerate}{\parskip\z@}{\parskip=0pt}{}{}
\patchcmd{\@description}{\parskip\z@}{\parskip=0pt}{}{}
\makeatother


% From previous debugging, I don't believe we need this anymore but keeping to be safe
% \AtBeginEnvironment{itemize}{
%   \setlength{\parskip}{0pt}
%   \setlength{\itemsep}{4pt}
%   \setlength{\topsep}{10pt}
%   \setlength{\parsep}{0pt}
%   \setlength{\partopsep}{0pt}
%   \linespread{1}\selectfont
% }
% \AtBeginEnvironment{enumerate}{
%   \setlength{\parskip}{0pt}
%   \setlength{\itemsep}{4pt}
%   \setlength{\topsep}{10pt}
%   \setlength{\parsep}{0pt}
%   \setlength{\partopsep}{0pt}
%   \linespread{1}\selectfont
% }
% \AtBeginEnvironment{description}{\setlength{\parskip}{4pt}}

\usepackage{changepage} % For adjustwidth environment

\begin{document}



\begingroup
\makeatletter
\setlength{\@fptop}{0pt}
\vspace*{-\topskip}
\makeatother
\endgroup
\vspace*{-\topskip}


$body$

\end{document}
